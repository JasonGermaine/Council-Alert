<!DOCTYPE html>
<html lang="en" ng-app>
<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

<script
	src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
<link rel="stylesheet" href="../css/navbar.css">
</head>

<body ng-controller="customersController">

	<nav class="navbar navbar-default">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../index.html"> <img
					style="height: 40px; width: 40px; margin-top: -10px; margin-left: -20px; margin-right: 10px;"
					class="img-responsive pull-left" src="../img/ic_launcher.png">
					<span class="pull-right">Council Alert</span>
				</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li><a href="../index.html">Home</a></li>
					<li class="dropdown active"><a href="#"
						class="dropdown-toggle" data-toggle="dropdown" role="button"
						aria-expanded="false"> Employee <span class="caret"></span>
					</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="displayEmployee.html">ALL</a></li>
							<li><a href="#">UNASSIGNED</a></li>
							<li class="divider"></li>
							<li><a href="addEmployee.html">ADD</a></li>
						</ul></li>
					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown" role="button" aria-expanded="false">
							Report <span class="caret"></span>
					</a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="../report/displayReport.html">ALL</a></li>
						</ul></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#">Login</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container">
		<h1>Employees</h1>
		<table class="table" style="margin-top: 50px;">
			<tr>
				<th>First Name</th>
				<th>Last Name</th>
				<th>Email</th>
				<th>Phone</th>
				<th>Password</th>
				<th>Assigned</th>
				<th>Device</th>
			</tr>
			<tr ng-repeat="emp in emps">
				<td>{{emp.firstName}}</td>
				<td>{{emp.lastName}}</td>
				<td>{{emp.email}}</td>
				<td>{{emp.phoneNum}}</td>
				<td>{{emp.password}}</td>
				<td>{{emp.report.id}}</td>
				<td>{{emp.deviceId}}</td>
				<td>
					<button ng-click="assign(emp.email, emp.latitude, emp.longitude)"
						class="btn btn-primary">Assign</button>
				</td>
			</tr>
		</table>
	</div>
	<div class="modal fade" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body">
					<table class="table">
						<tr>
							<th>Report ID</th>
							<th>Name</th>
							<th>Assign</th>
						</tr>
						<tr ng-repeat="report in reports">
							<td>{{report.id}}</td>
							<td>{{report.name}}</td>
							<td>
								<button ng-click="assignReport(report.id)"
									class="btn btn-primary">Assign</button>
							</td>
						</tr>
						</div>
						</div>
						<!-- /.modal-content -->
						</div>
						<!-- /.modal-dialog -->
						</div>
						<!-- /.modal -->
						<script>
							function customersController($scope, $http) {
								$http
										.get(
												"http://**/api/employee/unassignedlist")
										.success(function(response) {
											$scope.emps = response;
										});

								$scope.email = '';
								$scope.assign = function(email, lat, lon) {
									var url = 'http://**/api/report/unassigned?lat='
											+ lat + '&lon=' + lon;
									$http.get(url).success(function(data) {
										$scope.email = email;
										$scope.reports = data;
										$('#myModal').modal('show');
									});
								};

								$scope.assignReport = function(id) {
									var url = 'http://**/api/employee/assigntask?email='
											+ $scope.email + '&id=' + id;
									$http
											.get(url)
											.success(
													function(data) {
														$('#myModal').modal(
																'hide');
														window.location.href = "displayEmployee.html";
													});
								};
							}
						</script>
</body>
</html>